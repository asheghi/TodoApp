var v=Object.defineProperty,p=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var u=(e,t,o)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,f=(e,t)=>{for(var o in t||(t={}))x.call(t,o)&&u(e,o,t[o]);if(_)for(var o of _(t))k.call(t,o)&&u(e,o,t[o]);return e},g=(e,t)=>p(e,w(t));import{T as c}from"./client.73e92879.js";import{_ as C,o as a,c as l,a as i,n as y,e as b,v as D,f as B,F,g as O,h as r,t as m}from"./index.0c036e0e.js";const V={name:"Todos",data(){return{todos:[],newTask:"",count:null,fetching:null,loading:{},creating:!1}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:e}=await c.find().sort({createdAt:-1}).exec();this.todos=e,await this.fetchCount()}catch(e){console.error(e)}finally{this.fetching=!1}},async createTask(){try{this.creating=!0;const{data:e}=await c.create({name:this.newTask,done:!1});this.todos.splice(0,0,e),this.newTask="",this.fetchCount()}catch(e){console.error(e)}finally{this.creating=!1,await this.$nextTick(),document.querySelector(".form input").focus()}},async removeTodo(e){try{this.loading[e._id]=!0,await c.deleteOne({_id:e._id});const t=this.todos.findIndex(o=>o._id===e._id);this.todos.splice(t,1),await this.fetchCount()}catch(t){console.error(t)}finally{this.loading[e._id]=!1}},async toggleDone(e){this.loading[e._id]=!0;try{await c.updateOne({_id:e._id},g(f({},e),{done:!e.done}));const{data:t}=await c.findOne({_id:e._id}).exec(),o=this.todos.findIndex(h=>h._id===e._id);this.todos.splice(o,1),this.todos.splice(o,0,t)}catch(t){console.error(t)}finally{this.loading[e._id]=!1}},async fetchCount(){const{data:e}=await c.count();this.count=e}}},A={class:"Todos"},I={class:"form"},K=["disabled"],N=["disabled"],S={class:"list"},q=["disabled","checked","onClick"],z=["textContent"],E=["onClick"],L={key:1,class:"fetching"},M={key:0,class:"count"};function U(e,t,o,h,s,d){return a(),l("div",A,[i("div",I,[i("div",{class:y([{"skeleton-box":s.creating},"w-full"])},[b(i("input",{id:"todo","onUpdate:modelValue":t[0]||(t[0]=n=>s.newTask=n),disabled:s.creating,type:"text",name:"todo",placeholder:"yet another task",onKeydown:t[1]||(t[1]=B((...n)=>d.createTask&&d.createTask(...n),["enter"]))},null,40,K),[[D,s.newTask]])],2),i("button",{disabled:s.creating,onClick:t[2]||(t[2]=(...n)=>d.createTask&&d.createTask(...n))},"Add Todo",8,N)]),i("div",S,[s.fetching?r("",!0):(a(!0),l(F,{key:0},O(s.todos,n=>(a(),l("div",{key:n._id,class:y(["item",{done:n.done,"skeleton-box":s.loading[n._id],loading:s.loading[n._id]}])},[i("input",{disabled:s.loading[n._id],checked:n.done,type:"checkbox",onClick:T=>d.toggleDone(n)},null,8,q),i("div",{class:"name",textContent:m(n.name)},null,8,z),i("button",{class:"remove",onClick:T=>d.removeTodo(n)},"Delete",8,E)],2))),128)),s.fetching?(a(),l("div",L,"Fetching Data...")):r("",!0)]),s.count!=null?(a(),l("div",M,"Tasks: "+m(s.count),1)):r("",!0)])}var J=C(V,[["render",U]]);export{J as default};
