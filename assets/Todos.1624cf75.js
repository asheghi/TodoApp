import{T as d}from"./client.513c3109.js";import{_ as g,o as a,c as l,a as s,n as _,e as y,v as m,f as T,F as v,g as p,h as r,t as u}from"./index.abbfc032.js";const w={name:"Todos",data(){return{todos:[],newTask:"",count:null,fetching:null,loading:{},creating:!1}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:e}=await d.find().sort({createdAt:-1}).exec();this.todos=e,await this.fetchCount()}catch(e){console.error(e)}finally{this.fetching=!1}},async createTask(){try{this.creating=!0;const{data:e}=await d.create({name:this.newTask,done:!1});this.todos.splice(0,0,e),this.newTask="",this.fetchCount()}catch(e){console.error(e)}finally{this.creating=!1,await this.$nextTick(),document.querySelector(".form input").focus()}},async removeTodo(e){try{this.loading[e._id]=!0,await d.deleteOne({_id:e._id});const o=this.todos.findIndex(c=>c._id===e._id);this.todos.splice(o,1),await this.fetchCount()}catch(o){console.error(o)}finally{this.loading[e._id]=!1}},async toggleDone(e){this.loading[e._id]=!0;try{await d.updateOne({_id:e._id},{...e,done:!e.done});const{data:o}=await d.findOne({_id:e._id}).exec(),c=this.todos.findIndex(h=>h._id===e._id);this.todos.splice(c,1),this.todos.splice(c,0,o)}catch(o){console.error(o)}finally{this.loading[e._id]=!1}},async fetchCount(){const{data:e}=await d.count();this.count=e}}},x={class:"Todos"},k={class:"form"},C=["disabled"],b=["disabled"],D={class:"list"},B=["disabled","checked","onClick"],F=["textContent"],O=["onClick"],V={key:1,class:"fetching"},A={key:0,class:"count"};function I(e,o,c,h,n,i){return a(),l("div",x,[s("div",k,[s("div",{class:_([{"skeleton-box":n.creating},"w-full"])},[y(s("input",{id:"todo","onUpdate:modelValue":o[0]||(o[0]=t=>n.newTask=t),disabled:n.creating,type:"text",name:"todo",placeholder:"yet another task",onKeydown:o[1]||(o[1]=T((...t)=>i.createTask&&i.createTask(...t),["enter"]))},null,40,C),[[m,n.newTask]])],2),s("button",{disabled:n.creating,onClick:o[2]||(o[2]=(...t)=>i.createTask&&i.createTask(...t))},"Add Todo",8,b)]),s("div",D,[n.fetching?r("",!0):(a(!0),l(v,{key:0},p(n.todos,t=>(a(),l("div",{key:t._id,class:_(["item",{done:t.done,"skeleton-box":n.loading[t._id],loading:n.loading[t._id]}])},[s("input",{disabled:n.loading[t._id],checked:t.done,type:"checkbox",onClick:f=>i.toggleDone(t)},null,8,B),s("div",{class:"name",textContent:u(t.name)},null,8,F),s("button",{class:"remove",onClick:f=>i.removeTodo(t)},"Delete",8,O)],2))),128)),n.fetching?(a(),l("div",V,"Fetching Data...")):r("",!0)]),n.count!=null?(a(),l("div",A,"Tasks: "+u(n.count),1)):r("",!0)])}var S=g(w,[["render",I]]);export{S as default};
